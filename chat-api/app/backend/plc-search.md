# PLC 계층 검색 시스템

## 📋 개요

PLC 계층 검색 시스템은 Plant → 공정 → Line → 장비그룹 → 호기 순으로 계층적 검색을 제공하는 웹 인터페이스입니다. 최적화된 데이터 로딩과 클라이언트 사이드 필터링을 통해 빠른 검색 경험을 제공합니다.

## 🎯 주요 기능

### 1. 계층적 검색 시스템

#### 검색 계층 구조
```
Plant (DB 조회)
  └─ 공정 (클라이언트 필터링)
      └─ Line (클라이언트 필터링)
          └─ 장비그룹 (클라이언트 필터링)
              └─ 호기 (클라이언트 필터링)
```

#### 동작 방식
- **1단계 (Plant 선택)**: DB에서 해당 Plant의 모든 활성 PLC 데이터를 1회 조회
- **2-5단계**: 클라이언트에서 메모리 기반 필터링으로 즉시 응답
- **성능 최적화**: Plant 선택 시에만 DB 조회하여 서버 부하 최소화

### 2. 활성/비활성 PLC 관리

#### 통계 카드
- **총 활성 PLC**: 현재 활성 상태인 PLC 개수 표시
- **비활성 PLC**: 비활성 상태인 PLC 개수 표시
- 카드 클릭으로 활성/비활성 목록 즉시 전환

#### 데이터 조회 전략
- **활성 PLC**: Plant 선택 시 사전 로드 (클라이언트 캐싱)
- **비활성 PLC**: 검색 버튼 클릭 시 API 호출로 조회

### 3. 고급 테이블 기능

#### 정렬 기능
- **정렬 가능 컬럼**: PLC ID, Plant, 공정, Line, 장비그룹, 호기, PLC 명칭, 생성일시
- **정렬 방식**: 컬럼 헤더 클릭으로 오름차순/내림차순 토글
- **시각적 피드백**: 정렬 아이콘(▲▼)으로 현재 정렬 상태 표시
- **상태 컬럼**: 정렬 불가 (사용자 혼란 방지)

#### 테이블 레이아웃
- **열 폭 최적화**: 
  - 좌우 패딩: `15px 20px`
  - 최소 너비: `100px`
- **Hover 효과**: 행에 마우스 오버 시 배경색 변경
- **반응형 디자인**: 가로 스크롤 지원으로 모든 화면 크기 대응

### 4. 사용자 경험(UX) 개선

#### 실시간 피드백
- **로딩 상태**: 데이터 로딩 중 메시지 표시
- **성공/오류 메시지**: 작업 결과를 5초간 표시 후 자동 사라짐
- **카드 활성화**: 현재 보고 있는 목록을 녹색으로 강조

#### 부드러운 전환
- 모든 상태 변경 시 CSS transition 적용
- 검색 결과 표시 시 부드러운 스크롤 애니메이션

## 🖥️ 화면 구성

### 헤더 영역
```
┌──────────────────────────────────────────────────┐
│  🔍 PLC 계층 검색              [API 문서] [홈]    │
│  Plant → 공정 → Line → 장비그룹 → 호기 순으로 검색  │
│  ⚡ Plant 선택 시에만 DB 조회                     │
└──────────────────────────────────────────────────┘
```

### 검색 조건 영역
```
📋 검색 조건
┌──────────┬───────────┬───────────┬─────────────┬───────────┐
│ 1️⃣ Plant │ 2️⃣ 공정   │ 3️⃣ Line  │ 4️⃣ 장비그룹 │ 5️⃣ 호기   │
│  [선택▼]  │  [선택▼]  │  [선택▼]  │    [선택▼]   │  [선택▼]  │
└──────────┴───────────┴───────────┴─────────────┴───────────┘

[🔍 PLC 검색]  [🔄 초기화]
```

### 검색 결과 영역
```
📊 검색 결과

┌─────────────────────┬─────────────────────┐
│   총 활성 PLC       │   비활성 PLC        │
│      125            │       8             │
│   (클릭하여 전환)    │   (클릭하여 전환)    │
└─────────────────────┴─────────────────────┘

┌──────────────────────────────────────────────────┐
│ PLC ID ▲ │ Plant │ 공정 │ Line │ 장비그룹 │ 호기 │
├──────────────────────────────────────────────────┤
│ PLC001   │ P01   │ 공정A │ L01  │ EQ01    │ U01 │
│ PLC002   │ P01   │ 공정A │ L01  │ EQ01    │ U02 │
│   ...    │  ...  │ ...  │ ... │   ...   │ ... │
└──────────────────────────────────────────────────┘
```

## 🔧 기술 스펙

### API 엔드포인트

#### 1. Plant 목록 조회
```http
GET /api/v1/plcs/hierarchy/values?level=plant
```

#### 2. 활성 PLC 조회
```http
GET /api/v1/plcs?plant={plant}
```

#### 3. 비활성(삭제) PLC 조회
```http
GET /api/v1/plcs?is_active=false&plant={plant}&process={process}&line={line}&equipment_group={group}&unit={unit}
```

### 데이터 구조

#### PLC 객체
```javascript
{
  plc_id: string,           // PLC 고유 ID
  plant: string,            // Plant 코드
  process: string,          // 공정 코드
  line: string,             // Line 코드
  equipment_group: string,  // 장비그룹 코드
  unit: string,             // 호기 코드
  plc_name: string,         // PLC 명칭
  create_dt: string,        // 생성일시 (ISO 8601)
  is_active: boolean        // 활성 상태
}
```

### 전역 상태 관리

```javascript
let allPlcData = [];           // Plant의 모든 활성 PLC 데이터
let inactivePlcData = [];      // 검색된 비활성 PLC 데이터
let currentPlant = '';         // 현재 선택된 Plant
let currentView = 'active';    // 현재 보기 모드 (active/inactive)
let currentDisplayedData = []; // 현재 표시 중인 데이터
let sortColumn = null;         // 정렬 중인 컬럼
let sortDirection = 'asc';     // 정렬 방향 (asc/desc)
```

## 🎨 스타일 가이드

### 색상 팔레트
- **Primary**: `#667eea` → `#764ba2` (그라데이션)
- **Success**: `#4caf50` (활성 상태)
- **Error**: `#f44336` (비활성 상태)
- **Background**: `#f8f9ff` (Hover 배경)
- **Border**: `#e0e0e0`

### 주요 스타일 클래스

#### 통계 카드
```css
.stat-card {
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s;
}

.stat-card.active {
  background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
}
```

#### 테이블 셀
```css
th, td {
  padding: 15px 20px;
  min-width: 100px;
  border-bottom: 1px solid #e0e0e0;
}
```

#### 상태 뱃지
```css
.badge-active {
  background-color: #4caf50;
  color: white;
}

.badge-inactive {
  background-color: #f44336;
  color: white;
}
```

## 📱 반응형 디자인

### 브레이크포인트
- **Desktop**: 1200px 이상 (최대 너비 컨테이너)
- **Tablet**: 768px ~ 1199px (그리드 자동 조정)
- **Mobile**: 767px 이하 (세로 스크롤)

### 그리드 시스템
```css
.form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}
```

## ⚡ 성능 최적화

### 1. 데이터 로딩 전략
- **한 번의 DB 조회**: Plant 선택 시에만 서버 통신
- **클라이언트 캐싱**: 메모리에 데이터 저장 후 재사용
- **지연 로딩**: 비활성 PLC는 필요 시에만 조회

### 2. 렌더링 최적화
- **조건부 렌더링**: 빈 결과 시 최소 DOM 생성
- **이벤트 위임**: 테이블 행별 이벤트 대신 위임 패턴
- **CSS Transition**: GPU 가속 활용

### 3. 메모리 관리
- **데이터 초기화**: 폼 리셋 시 메모리 해제
- **이벤트 정리**: 필요 시 이벤트 리스너 제거

## 🔍 사용자 시나리오

### 시나리오 1: 특정 호기의 PLC 검색
1. Plant 선택 (예: "P01")
   - 서버에서 P01의 모든 활성 PLC 데이터 로드
2. 공정 선택 (예: "공정A")
   - 클라이언트에서 즉시 필터링
3. Line 선택 (예: "L01")
   - 클라이언트에서 즉시 필터링
4. 장비그룹 선택 (예: "EQ01")
   - 클라이언트에서 즉시 필터링
5. 호기 선택 (예: "U01")
   - 클라이언트에서 즉시 필터링
6. "🔍 PLC 검색" 버튼 클릭
   - 활성/비활성 PLC 결과 표시

### 시나리오 2: 비활성 PLC 확인
1. 검색 완료 후 통계 카드에서 "비활성 PLC" 클릭
2. 테이블이 비활성 PLC 목록으로 즉시 전환
3. 필요 시 "총 활성 PLC" 클릭하여 다시 전환

### 시나리오 3: PLC ID로 정렬
1. 테이블 헤더의 "PLC ID" 클릭 (오름차순 정렬)
2. 다시 클릭 (내림차순 정렬)
3. 정렬 아이콘(▲▼)으로 현재 정렬 상태 확인

## 🔗 관련 파일

- **HTML**: `plc-search.html`
- **API 문서**: `/docs` 경로 참조
- **백엔드 API**: `/api/v1/plcs/*` 엔드포인트